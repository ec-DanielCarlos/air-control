#include <stdio.h>
#include "timer_qcx212.h"
#include "bsp.h"
#include "stdint.h"
#include "stddef.h"
#include "FreeRTOS.h"
#include "task.h"
#include "timer_qcx212.h"
#include "bsp.h"
#include <stdint.h>
#define USE_USART_DEBUG
#include "main.h"
#include "FreeRTOS.h"
#include "task.h"
#include "queue.h"
#include "slpman_qcx212.h"
#include "pad_qcx212.h"
#include "HT_gpio_qcx212.h"
#include "ic_qcx212.h"
#include "HT_ic_qcx212.h"
#include "HT_adc_qcx212.h"
#include "adc_qcx212.h"
#include "hal_adc.h"
#include <stdio.h>
#include "string.h"
#include "HT_bsp.h"
#include "stdint.h"
#include "qcx212.h"
#include "HT_Fsm.h"
#include "HT_PWM.h"


/** \brief TIMER instance for PWM output */
#define PWM_INSTANCE                     (0)

/** \brief PWM clock id for clock configuration */
#define PWM_CLOCK_ID                     (GPR_TIMER0FuncClk)

/** \brief PWM clock source select */
#define PWM_CLOCK_SOURCE                 (GPR_TIMER0ClkSel_26M )

/** \brief PWM initial duty cycle percent */
#define PWM_INIT_DUTY_CYCLE_PERCENT      (50)

/** \brief TIMER/PWM out pin */
#define PWM_OUT_PIN                      (13)

/** \brief TIMER/PWM Alt function select */
#define PWM_OUT_ALT_SEL                  (PAD_MuxAlt5)

/** \brief TIMER instance for PWM duty cycle control */
#define TIMER_INSTANCE                   (1)

/** \brief TIMER clock id for clock configuration */
#define TIMER_CLOCK_ID                   (GPR_TIMER1FuncClk)

/** \brief TIMER clock source select */
#define TIMER_CLOCK_SOURCE               (GPR_TIMER1ClkSel_32K)

/** \brief TIMER instance IRQ number */
#define TIMER_INSTANCE_IRQ               (PXIC_Timer1_IRQn)

volatile int update = 0;


#define  CUSTOM_DELAY_US_CALIBRATION 2.16

void custom_delay_usec(uint32_t us)
{
  float countings = us * CUSTOM_DELAY_US_CALIBRATION;
  for(uint32_t fh = 0; fh < countings; fh++)
    __asm volatile("NOP");
}

void pwm_config(void);
void delay_us(uint32_t us);
void stop_pwm(uint16_t time);
void start_pwm(uint16_t time);
//void vPwm(void);
//void envPwm(void *arg);
//static void HT_GPIO_InitLed(void);



// void envPwm(void *arg){
//          switch ()
//         {
//         case 0 :
//             static const uint16_t rawUs[SIGNAL_LEN] = {4380,4420, 530,1620, 530,520, 530,1670, 480,1670, 480,570, 530,520, 530,1670, 480,570, 530,520, 530,1670, 480,570, 530,520, 530,1670, 480,1670, 480,570, 530,1620, 530,520, 530,1670, 480,1670, 480,1670, 480,1670, 480,520, 580,1620, 530,1620, 480,1670, 480,570, 530,520, 530,570, 530,520, 530,1670, 480,570, 530,520, 530,1670, 480,1670, 480,1670, 480,570, 530,520, 530,570, 530,520, 530,570, 530,520, 530,570, 530,520, 530,1670, 480,1620, 530,1620, 530,1620, 530,1620, 530,5220, 4380,4370, 530,1670, 480,570, 530,1620, 530,1620, 530,520, 530,570, 530,1620, 530,520, 530,520, 580,1620, 480,570, 530,520, 530,1670, 480,1670, 480,570, 530,1620, 530,520, 530,1670, 480,1670, 480,1670, 480,1670, 480,570, 480,1670, 480,1670, 480,1670, 480,570, 530,520, 580,520, 530,520, 530,1620, 530,570, 480,570, 530,1620, 530,1620, 530,1620, 530,570, 480,570, 530,570, 480,570, 530,570, 480,570, 530,570, 480,570, 530,1620, 530,1620, 530,1620, 480,1670, 480,1670, 480}; 
//             break;

//         case 17 :
//             static const uint16_t rawUs[SIGNAL_LEN] = {4330,4420, 530,1670, 480,570, 480,1670, 480,1670, 480,570, 480,620, 480,1670, 480,570, 480,620, 480,1670, 480,570, 480,570, 530,1620, 530,1620, 480,620, 480,1670, 480,1670, 480,570, 480,620, 480,1670, 480,1670, 480,1670, 480,1670, 480,1670, 480,570, 480,1670, 480,1670, 480,620, 480,570, 530,570, 480,570, 530,520, 530,570, 530,520, 530,570, 530,520, 530,570, 530,520, 580,520, 530,520, 530,1620, 530,1620, 530,1620, 530,1620, 530,1620, 530,1620, 530,1620, 530,1620, 530,5220, 4380,4370, 580,1570, 580,520, 580,1570, 530,1620, 530,520, 580,520, 530,1620, 530,520, 580,520, 530,1620, 580,470, 580,520, 580,1570, 530,1570, 580,520, 580,1570, 580,1570, 580,470, 580,520, 580,1570, 580,1570, 580,1570, 580,1570, 580,1570, 580,470, 580,1570, 580,1570, 580,520, 530,520, 580,470, 580,520, 580,470, 580,520, 580,470, 580,520, 530,520, 580,520, 530,520, 580,520, 530,520, 530,1620, 530,1620, 530,1620, 530,1620, 530,1620, 530,1620, 530,1620, 530,1620, 530};
//             break;

//         case 18 :
//             static const uint16_t rawUs[SIGNAL_LEN] = {4330,4470, 480,1670, 480,570, 480,1670, 480,1670, 480,570, 530,570, 480,1720, 430,570, 530,570, 480,1670, 480,570, 530,570, 480,1670, 480,1670, 480,570, 480,1670, 480,1670, 480,620, 480,570, 480,1670, 480,1670, 480,1670, 480,1670, 480,1670, 480,620, 480,1670, 480,1670, 480,570, 480,570, 530,570, 480,570, 530,570, 480,570, 530,570, 480,570, 480,1670, 480,620, 480,570, 480,620, 480,570, 480,1670, 480,1670, 530,1620, 480,620, 480,1670, 480,1670, 480,1670, 480,1670, 480,5220, 4330,4470, 480,1670, 480,570, 480,1670, 480,1670, 480,620, 480,570, 480,1670, 480,620, 480,570, 480,1670, 480,570, 530,570, 480,1670, 480,1670, 480,570, 530,1670, 430,1720, 430,620, 530,520, 580,1620, 480,1670, 480,1670, 480,1620, 530,1620, 530,570, 530,1620, 530,1570, 580,520, 530,520, 580,520, 530,520, 580,520, 530,520, 580,520, 530,520, 580,1570, 580,520, 530,520, 580,520, 530,520, 530,1620, 530,1620, 530,1620, 530,570, 530,1620, 530,1570, 580,1570, 580,1570, 530};  
//             break;

//         case 19:
//             static const uint16_t rawUs[SIGNAL_LEN] = {4330,4420, 530,1670, 480,570, 480,1670, 480,1670, 480,570, 530,570, 480,1670, 480,570, 530,570, 480,1670, 480,570, 480,620, 480,1670, 480,1670, 480,570, 480,1670, 480,1670, 480,620, 480,570, 480,1670, 480,1670, 480,1670, 480,1670, 480,1670, 480,570, 530,1620, 530,1620, 480,620, 530,520, 530,570, 530,520, 530,570, 530,520, 530,570, 480,1670, 480,1670, 480,570, 530,570, 480,570, 530,570, 480,1670, 480,1670, 480,570, 530,520, 530,1620, 530,1620, 530,1620, 480,1670, 480,5270, 4380,4420, 480,1670, 480,570, 530,1620, 530,1620, 530,520, 580,520, 530,1620, 530,520, 580,520, 530,1620, 530,520, 580,520, 530,1620, 530,1620, 530,520, 580,1620, 530,1570, 580,520, 580,470, 580,1570, 580,1570, 580,1570, 580,1570, 580,1570, 580,470, 580,1570, 580,1570, 580,520, 580,470, 580,520, 580,470, 580,520, 580,470, 580,520, 530,1620, 530,1620, 530,520, 530,520, 580,520, 530,520, 580,1570, 580,1570, 580,520, 530,520, 530,1620, 530,1620, 530,1620, 530,1620, 530};  
//             break;

//         case 20 :
//             static const uint16_t rawUs[SIGNAL_LEN] = {4330,4420, 480,1670, 480,620, 480,1670, 480,1670, 480,570, 480,620, 480,1670, 480,570, 480,620, 480,1670, 480,570, 480,620, 480,1670, 480,1620, 530,570, 480,1670, 480,1670, 480,570, 530,570, 480,1670, 480,1670, 480,1670, 480,1670, 480,1670, 480,570, 480,1670, 480,1670, 480,620, 480,570, 480,620, 480,570, 480,620, 480,570, 480,620, 480,1620, 530,570, 480,570, 530,570, 480,570, 530,570, 530,1620, 480,1670, 480,570, 530,1620, 480,1670, 480,1670, 480,1670, 480,1670, 480,5270, 4380,4370, 530,1620, 530,570, 530,1620, 530,1620, 480,570, 580,520, 530,1620, 530,520, 580,520, 530,1620, 530,520, 580,520, 530,1620, 530,1620, 530,520, 580,1570, 530,1620, 580,470, 580,520, 580,1570, 580,1570, 580,1570, 580,1570, 530,1620, 580,470, 580,1570, 580,1570, 580,470, 580,520, 530,520, 580,520, 530,520, 580,520, 530,520, 580,1570, 580,520, 530,520, 530,570, 530,520, 530,570, 530,1620, 530,1620, 530,520, 530,1620, 530,1620, 530,1620, 530,1620, 480,1670, 480};  
//             break;

//         case 21 :
//             static const uint16_t rawUs[SIGNAL_LEN] = {4330,4470, 480,1670, 480,570, 530,1620, 480,1670, 480,570, 530,570, 530,1620, 530,520, 580,520, 530,1620, 530,520, 580,520, 530,1620, 530,1620, 480,570, 530,1620, 530,1620, 530,570, 530,520, 580,1570, 530,1620, 530,1620, 530,1620, 530,1620, 530,520, 580,1570, 530,1620, 530,570, 530,520, 580,520, 530,520, 580,520, 530,520, 580,1570, 530,1620, 530,570, 530,520, 580,520, 530,520, 580,520, 530,1620, 480,570, 580,470, 630,1520, 530,1620, 530,1620, 530,1620, 530,1620, 580,5170, 4430,4370, 530,1620, 530,520, 580,1570, 530,1620, 530,520, 580,520, 530,1620, 530,520, 580,520, 530,1620, 530,520, 580,520, 530,1620, 530,1620, 580,470, 580,1620, 480,1670, 480,520, 580,520, 530,1620, 580,1570, 580,1570, 530,1620, 580,1570, 580,470, 580,1570, 580,1570, 580,520, 580,470, 580,520, 530,520, 580,520, 530,520, 580,1570, 580,1570, 580,470, 580,520, 580,470, 580,520, 580,470, 580,1570, 580,520, 530,520, 580,1570, 580,1570, 530,1620, 530,1620, 530,1620, 530};  
//             break;

//         case 22 :
//             static const uint16_t rawUs[SIGNAL_LEN] = {4330,4470, 480,1670, 480,570, 530,1670, 480,1670, 480,570, 480,570, 530,1670, 480,570, 480,570, 530,1670, 480,520, 530,570, 530,1620, 480,1670, 530,520, 530,1670, 480,1670, 480,570, 480,570, 530,1670, 480,1670, 480,1620, 530,1670, 480,1620, 530,570, 480,1670, 480,1670, 530,520, 530,570, 480,570, 530,570, 480,570, 530,520, 530,1670, 480,1620, 530,1620, 530,570, 480,570, 530,570, 480,570, 530,1670, 480,570, 480,570, 480,620, 480,1670, 480,1670, 480,1670, 480,1670, 480,5220, 4380,4420, 480,1670, 480,570, 580,1570, 530,1620, 530,570, 530,520, 530,1620, 530,570, 530,520, 530,1620, 530,570, 530,520, 530,1620, 530,1620, 530,520, 580,1570, 530,1620, 530,570, 530,520, 530,1620, 530,1620, 530,1620, 530,1620, 530,1620, 530,570, 480,1670, 480,1620, 530,570, 480,570, 530,570, 480,570, 530,570, 480,570, 530,1620, 530,1620, 530,1620, 530,570, 480,570, 530,570, 480,570, 530,1620, 530,570, 480,570, 480,570, 530,1620, 530,1670, 480,1670, 480,1670, 480}; 
//             break;

//         case 23 : 
//             static const uint16_t rawUs[SIGNAL_LEN] = {4380,4420, 530,1620, 530,520, 530,1670, 480,1670, 480,570, 530,520, 530,1670, 480,570, 530,520, 530,1670, 480,570, 530,520, 530,1670, 480,1620, 530,520, 580,1620, 480,1670, 480,570, 530,520, 530,1670, 480,1670, 480,1670, 480,1670, 480,1670, 480,570, 530,1620, 530,1620, 530,520, 530,570, 530,520, 530,570, 530,520, 530,520, 580,1620, 480,570, 530,1620, 530,520, 530,570, 530,520, 530,570, 530,1620, 530,520, 530,1670, 480,570, 530,1620, 530,1620, 530,1620, 530,1620, 530,5170, 4380,4420, 480,1670, 480,570, 530,1670, 480,1670, 480,570, 530,520, 530,1670, 480,570, 530,520, 530,1620, 530,520, 580,520, 530,1620, 530,1620, 480,570, 530,1670, 480,1670, 480,570, 480,570, 530,1670, 480,1670, 480,1670, 430,1670, 480,1670, 480,620, 480,1620, 530,1620, 530,570, 530,520, 580,520, 530,520, 580,520, 530,520, 580,1570, 530,570, 530,1620, 530,520, 530,570, 530,520, 530,570, 530,1620, 530,520, 530,1620, 530,520, 580,1570, 580,1570, 530,1620, 530,1620, 530};
//             break;

//         case 24 :
//             static const uint16_t rawUs[SIGNAL_LEN] = {4380,4370, 530,1670, 480,570, 530,1620, 530,1620, 530,520, 530,570, 530,1620, 530,520, 530,570, 530,1620, 530,520, 530,570, 530,1620, 530,1620, 530,520, 530,1670, 480,1670, 480,570, 530,520, 530,1620, 530,1620, 530,1620, 530,1620, 530,1620, 530,520, 530,1670, 480,1670, 480,570, 530,520, 530,570, 530,520, 530,570, 530,520, 530,1670, 480,570, 530,520, 530,570, 530,520, 530,570, 530,520, 530,1670, 480,570, 480,1670, 480,1670, 480,1670, 480,1670, 480,1670, 480,1670, 480,5220, 4330,4470, 480,1670, 480,570, 530,1620, 480,1670, 530,570, 480,570, 530,1620, 530,520, 530,570, 530,1620, 480,570, 530,570, 480,1670, 480,1670, 480,570, 530,1620, 530,1620, 530,570, 480,570, 530,1620, 530,1620, 530,1620, 530,1620, 530,1620, 480,570, 530,1620, 530,1620, 530,570, 480,570, 530,570, 480,570, 530,570, 480,570, 530,1670, 480,570, 480,570, 530,570, 480,570, 530,570, 480,570, 530,1670, 480,570, 480,1670, 480,1670, 480,1670, 480,1670, 480,1670, 480,1670, 480};
//             break;

//         case 25 :
//             static const uint16_t rawUs[SIGNAL_LEN] = {4330,4420, 530,1670, 480,570, 480,1670, 480,1670, 480,570, 530,520, 530,1670, 480,570, 480,570, 530,1620, 480,620, 480,570, 480,1720, 430,1670, 480,620, 480,1670, 480,1670, 480,570, 480,620, 480,1670, 480,1670, 480,1670, 480,1670, 480,1670, 480,570, 480,1670, 480,1670, 480,570, 530,570, 480,570, 480,620, 480,570, 480,1670, 480,1670, 480,620, 480,570, 480,620, 480,570, 480,620, 480,570, 480,620, 480,570, 480,1670, 480,1670, 480,1670, 480,1670, 480,1670, 480,1670, 480,5270, 4330,4420, 480,1670, 480,570, 530,1620, 530,1620, 530,570, 530,520, 530,1620, 530,570, 530,520, 580,1570, 530,570, 530,520, 580,1570, 530,1620, 530,570, 580,1570, 530,1620, 530,520, 530,520, 580,1620, 530,1620, 530,1620, 530,1570, 580,1570, 580,520, 580,1570, 580,1570, 580,470, 580,520, 580,470, 580,520, 530,520, 580,1570, 580,1570, 580,470, 580,520, 580,470, 580,520, 580,470, 580,520, 580,470, 580,520, 580,1570, 530,1620, 530,1620, 530,1620, 530,1620, 530,1570, 580};
//             break;
            
//         case 26 :
//             static const uint16_t rawUs[SIGNAL_LEN] = {4430,4370, 530,1620, 480,570, 530,1670, 480,1670, 480,570, 480,570, 530,1670, 480,570, 480,570, 530,1670, 430,620, 480,570, 480,1720, 480,1620, 480,620, 480,1670, 480,1670, 480,570, 480,620, 480,1670, 480,1670, 480,1620, 530,1620, 530,1620, 530,570, 480,1670, 480,1670, 480,570, 480,620, 480,570, 480,620, 480,570, 480,1670, 480,1670, 480,620, 480,1670, 480,570, 530,570, 480,570, 530,570, 480,570, 530,570, 530,1620, 480,570, 530,1620, 530,1620, 530,1620, 530,1620, 530,5220, 4380,4370, 580,1620, 530,520, 530,1620, 530,1570, 580,520, 580,470, 580,1570, 580,520, 580,470, 580,1570, 580,520, 580,470, 580,1570, 580,1570, 580,520, 580,1570, 580,1570, 530,520, 580,520, 530,1570, 580,1570, 580,1570, 580,1570, 580,1570, 580,520, 530,1620, 530,1620, 530,520, 530,570, 530,520, 530,570, 530,520, 530,1620, 530,1620, 530,570, 530,1570, 530,570, 530,520, 530,570, 480,570, 530,570, 480,570, 530,1620, 530,570, 480,1670, 480,1670, 480,1670, 480,1670, 480};  
//             break;

//         case 27 :
//             static const uint16_t rawUs[SIGNAL_LEN] = {4330,4420, 530,1670, 480,570, 530,1620, 480,1670, 530,520, 530,520, 580,1620, 530,520, 530,520, 580,1620, 480,570, 530,520, 530,1670, 480,1670, 480,570, 530,1620, 530,1620, 480,570, 530,570, 530,1620, 530,1620, 530,1620, 530,1620, 530,1620, 530,520, 530,1670, 480,1670, 480,570, 530,520, 530,520, 530,570, 530,520, 530,1670, 530,520, 530,520, 580,1620, 480,570, 530,520, 530,570, 530,520, 530,570, 480,1670, 480,1670, 480,570, 530,1670, 480,1670, 480,1670, 480,1670, 480,5220, 4380,4370, 530,1620, 530,570, 530,1620, 480,1670, 480,570, 530,570, 480,1670, 480,570, 530,570, 480,1670, 480,570, 530,520, 530,1670, 480,1620, 530,570, 480,1670, 480,1670, 480,570, 480,620, 480,1670, 480,1670, 480,1670, 480,1670, 480,1670, 480,570, 530,1620, 480,1670, 480,570, 530,570, 530,520, 580,520, 530,520, 580,1570, 580,520, 530,520, 580,1570, 530,570, 530,520, 530,570, 530,520, 530,570, 530,1620, 530,1620, 530,520, 530,1620, 530,1620, 530,1620, 530,1620, 530};  
//             break;

//         case 28 :
//             static const uint16_t rawUs[SIGNAL_LEN] = {4380,4420, 530,1620, 530,520, 530,1670, 480,1670, 480,570, 530,520, 530,1670, 480,570, 530,520, 530,1620, 530,520, 580,520, 530,1620, 530,1620, 530,520, 530,1670, 480,1670, 480,570, 530,520, 530,1670, 480,1670, 480,1670, 480,1670, 480,1670, 480,570, 530,1620, 530,1620, 530,520, 530,570, 530,520, 530,570, 530,520, 530,1620, 530,520, 580,520, 530,520, 580,520, 530,520, 580,520, 530,520, 530,570, 530,1620, 530,1620, 530,1620, 530,1620, 530,1620, 530,1620, 530,1620, 530,5170, 4380,4420, 530,1620, 530,520, 530,1670, 480,1670, 480,570, 530,520, 530,1670, 480,570, 530,520, 530,1670, 480,570, 530,520, 530,1670, 480,1670, 480,570, 530,1620, 530,1620, 480,570, 530,520, 530,1670, 480,1670, 480,1670, 480,1670, 480,1670, 480,570, 480,1670, 480,1670, 480,570, 530,570, 480,570, 530,570, 480,570, 530,1620, 530,520, 530,570, 530,520, 530,570, 530,520, 530,570, 480,570, 530,570, 480,1670, 480,1670, 480,1670, 480,1670, 480,1670, 480,1670, 480,1670, 480};  
//             break;

//         case 29 :
//             static const uint16_t rawUs[SIGNAL_LEN] = {4380,4370, 530,1670, 480,570, 530,1620, 530,1620, 530,520, 530,570, 530,1620, 530,520, 530,570, 530,1620, 530,520, 530,570, 530,1620, 530,1620, 530,520, 530,1670, 480,1620, 530,520, 580,520, 530,1620, 530,1620, 530,1620, 530,1620, 530,1620, 530,520, 530,1670, 480,1670, 480,570, 530,520, 530,570, 530,520, 530,570, 530,1620, 480,570, 530,1670, 480,520, 580,520, 530,520, 580,520, 530,520, 530,570, 530,1620, 480,570, 530,1670, 480,1670, 480,1670, 480,1670, 480,1670, 480,5220, 4330,4420, 480,1670, 480,620, 480,1670, 480,1670, 480,570, 530,570, 480,1670, 480,570, 530,570, 530,1620, 480,570, 530,570, 530,1620, 530,1620, 480,570, 530,1620, 530,1620, 530,520, 580,520, 480,1670, 530,1620, 480,1670, 480,1670, 480,1670, 480,570, 530,1620, 530,1620, 530,570, 480,570, 530,520, 530,570, 480,570, 530,1620, 530,570, 480,1670, 480,570, 530,570, 480,570, 530,570, 480,570, 530,570, 480,1670, 480,570, 530,1620, 530,1620, 480,1670, 480,1670, 480,1670, 480};  
//             break;

//         case 30 :
//             const uint16_t rawUs[SIGNAL_LEN] = {4330,4420, 480,1670, 480,620, 480,1670, 480,1670, 480,570, 480,570, 530,1620, 530,570, 480,570, 530,1620, 480,620, 480,570, 480,1670, 480,1670, 480,620, 480,1670, 480,1670, 480,570, 480,620, 480,1670, 480,1670, 480,1670, 480,1670, 480,1670, 480,570, 480,1670, 480,1670, 480,570, 530,570, 480,570, 530,570, 480,570, 530,1620, 480,620, 480,1670, 480,1670, 480,570, 480,620, 480,570, 480,620, 480,570, 480,1670, 480,620, 480,570, 480,1670, 480,1670, 480,1670, 480,1670, 480,5270, 4330,4420, 480,1670, 480,620, 480,1670, 480,1670, 480,570, 480,620, 480,1620, 530,570, 480,570, 530,1620, 480,620, 530,520, 530,1620, 480,1720, 430,620, 530,1620, 480,1670, 480,570, 580,520, 530,1620, 530,1620, 530,1620, 530,1620, 530,1570, 580,520, 530,1620, 530,1620, 530,520, 580,520, 580,470, 580,520, 580,470, 580,1570, 580,520, 530,1620, 530,1620, 530,520, 580,520, 530,520, 530,520, 580,520, 530,1620, 530,520, 580,520, 530,1620, 530,1620, 530,1620, 530,1620, 530};  
//             break;
 
//         default:
//             break;
//         }

//         vPwm();
    
// }



 //static const uint16_t rawUs[SIGNAL_LEN] = 
// //On 24 
// //{4380,4370, 530,1670, 480,570, 530,1620, 530,1620, 530,520, 530,570, 530,1620, 530,520, 530,570, 530,1620, 530,520, 530,570, 530,1620, 530,1620, 530,520, 530,1670, 480,1670, 480,570, 530,520, 530,1620, 530,1620, 530,1620, 530,1620, 530,1620, 530,520, 530,1670, 480,1670, 480,570, 530,520, 530,570, 530,520, 530,570, 530,520, 530,1670, 480,570, 530,520, 530,570, 530,520, 530,570, 530,520, 530,1670, 480,570, 480,1670, 480,1670, 480,1670, 480,1670, 480,1670, 480,1670, 480,5220, 4330,4470, 480,1670, 480,570, 530,1620, 480,1670, 530,570, 480,570, 530,1620, 530,520, 530,570, 530,1620, 480,570, 530,570, 480,1670, 480,1670, 480,570, 530,1620, 530,1620, 530,570, 480,570, 530,1620, 530,1620, 530,1620, 530,1620, 530,1620, 480,570, 530,1620, 530,1620, 530,570, 480,570, 530,570, 480,570, 530,570, 480,570, 530,1670, 480,570, 480,570, 530,570, 480,570, 530,570, 480,570, 530,1670, 480,570, 480,1670, 480,1670, 480,1670, 480,1670, 480,1670, 480,1670, 480};
// //0ff 24
// //{4380,4420, 530,1620, 530,520, 530,1670, 480,1670, 480,570, 530,520, 530,1670, 480,570, 530,520, 530,1670, 480,570, 530,520, 530,1670, 480,1670, 480,570, 530,1620, 530,520, 530,1670, 480,1670, 480,1670, 480,1670, 480,520, 580,1620, 530,1620, 480,1670, 480,570, 530,520, 530,570, 530,520, 530,1670, 480,570, 530,520, 530,1670, 480,1670, 480,1670, 480,570, 530,520, 530,570, 530,520, 530,570, 530,520, 530,570, 530,520, 530,1670, 480,1620, 530,1620, 530,1620, 530,1620, 530,5220, 4380,4370, 530,1670, 480,570, 530,1620, 530,1620, 530,520, 530,570, 530,1620, 530,520, 530,520, 580,1620, 480,570, 530,520, 530,1670, 480,1670, 480,570, 530,1620, 530,520, 530,1670, 480,1670, 480,1670, 480,1670, 480,570, 480,1670, 480,1670, 480,1670, 480,570, 530,520, 580,520, 530,520, 530,1620, 530,570, 480,570, 530,1620, 530,1620, 530,1620, 530,570, 480,570, 530,570, 480,570, 530,570, 480,570, 530,570, 480,570, 530,1620, 530,1620, 530,1620, 480,1670, 480,1670, 480}; 
// //On 17
//  {4330,4420, 530,1670, 480,570, 480,1670, 480,1670, 480,570, 480,620, 480,1670, 480,570, 480,620, 480,1670, 480,570, 480,570, 530,1620, 530,1620, 480,620, 480,1670, 480,1670, 480,570, 480,620, 480,1670, 480,1670, 480,1670, 480,1670, 480,1670, 480,570, 480,1670, 480,1670, 480,620, 480,570, 530,570, 480,570, 530,520, 530,570, 530,520, 530,570, 530,520, 530,570, 530,520, 580,520, 530,520, 530,1620, 530,1620, 530,1620, 530,1620, 530,1620, 530,1620, 530,1620, 530,1620, 530,5220, 4380,4370, 580,1570, 580,520, 580,1570, 530,1620, 530,520, 580,520, 530,1620, 530,520, 580,520, 530,1620, 580,470, 580,520, 580,1570, 530,1570, 580,520, 580,1570, 580,1570, 580,470, 580,520, 580,1570, 580,1570, 580,1570, 580,1570, 580,1570, 580,470, 580,1570, 580,1570, 580,520, 530,520, 580,470, 580,520, 580,470, 580,520, 580,470, 580,520, 530,520, 580,520, 530,520, 580,520, 530,520, 530,1620, 530,1620, 530,1620, 530,1620, 530,1620, 530,1620, 530,1620, 530,1620, 530};
// //On 18
// //{4330,4470, 480,1670, 480,570, 480,1670, 480,1670, 480,570, 530,570, 480,1720, 430,570, 530,570, 480,1670, 480,570, 530,570, 480,1670, 480,1670, 480,570, 480,1670, 480,1670, 480,620, 480,570, 480,1670, 480,1670, 480,1670, 480,1670, 480,1670, 480,620, 480,1670, 480,1670, 480,570, 480,570, 530,570, 480,570, 530,570, 480,570, 530,570, 480,570, 480,1670, 480,620, 480,570, 480,620, 480,570, 480,1670, 480,1670, 530,1620, 480,620, 480,1670, 480,1670, 480,1670, 480,1670, 480,5220, 4330,4470, 480,1670, 480,570, 480,1670, 480,1670, 480,620, 480,570, 480,1670, 480,620, 480,570, 480,1670, 480,570, 530,570, 480,1670, 480,1670, 480,570, 530,1670, 430,1720, 430,620, 530,520, 580,1620, 480,1670, 480,1670, 480,1620, 530,1620, 530,570, 530,1620, 530,1570, 580,520, 530,520, 580,520, 530,520, 580,520, 530,520, 580,520, 530,520, 580,1570, 580,520, 530,520, 580,520, 530,520, 530,1620, 530,1620, 530,1620, 530,570, 530,1620, 530,1570, 580,1570, 580,1570, 530};  
// //19
// //{4330,4420, 530,1670, 480,570, 480,1670, 480,1670, 480,570, 530,570, 480,1670, 480,570, 530,570, 480,1670, 480,570, 480,620, 480,1670, 480,1670, 480,570, 480,1670, 480,1670, 480,620, 480,570, 480,1670, 480,1670, 480,1670, 480,1670, 480,1670, 480,570, 530,1620, 530,1620, 480,620, 530,520, 530,570, 530,520, 530,570, 530,520, 530,570, 480,1670, 480,1670, 480,570, 530,570, 480,570, 530,570, 480,1670, 480,1670, 480,570, 530,520, 530,1620, 530,1620, 530,1620, 480,1670, 480,5270, 4380,4420, 480,1670, 480,570, 530,1620, 530,1620, 530,520, 580,520, 530,1620, 530,520, 580,520, 530,1620, 530,520, 580,520, 530,1620, 530,1620, 530,520, 580,1620, 530,1570, 580,520, 580,470, 580,1570, 580,1570, 580,1570, 580,1570, 580,1570, 580,470, 580,1570, 580,1570, 580,520, 580,470, 580,520, 580,470, 580,520, 580,470, 580,520, 530,1620, 530,1620, 530,520, 530,520, 580,520, 530,520, 580,1570, 580,1570, 580,520, 530,520, 530,1620, 530,1620, 530,1620, 530,1620, 530};  
// //20
// //{4330,4420, 480,1670, 480,620, 480,1670, 480,1670, 480,570, 480,620, 480,1670, 480,570, 480,620, 480,1670, 480,570, 480,620, 480,1670, 480,1620, 530,570, 480,1670, 480,1670, 480,570, 530,570, 480,1670, 480,1670, 480,1670, 480,1670, 480,1670, 480,570, 480,1670, 480,1670, 480,620, 480,570, 480,620, 480,570, 480,620, 480,570, 480,620, 480,1620, 530,570, 480,570, 530,570, 480,570, 530,570, 530,1620, 480,1670, 480,570, 530,1620, 480,1670, 480,1670, 480,1670, 480,1670, 480,5270, 4380,4370, 530,1620, 530,570, 530,1620, 530,1620, 480,570, 580,520, 530,1620, 530,520, 580,520, 530,1620, 530,520, 580,520, 530,1620, 530,1620, 530,520, 580,1570, 530,1620, 580,470, 580,520, 580,1570, 580,1570, 580,1570, 580,1570, 530,1620, 580,470, 580,1570, 580,1570, 580,470, 580,520, 530,520, 580,520, 530,520, 580,520, 530,520, 580,1570, 580,520, 530,520, 530,570, 530,520, 530,570, 530,1620, 530,1620, 530,520, 530,1620, 530,1620, 530,1620, 530,1620, 480,1670, 480};  
// //21
// //{4330,4470, 480,1670, 480,570, 530,1620, 480,1670, 480,570, 530,570, 530,1620, 530,520, 580,520, 530,1620, 530,520, 580,520, 530,1620, 530,1620, 480,570, 530,1620, 530,1620, 530,570, 530,520, 580,1570, 530,1620, 530,1620, 530,1620, 530,1620, 530,520, 580,1570, 530,1620, 530,570, 530,520, 580,520, 530,520, 580,520, 530,520, 580,1570, 530,1620, 530,570, 530,520, 580,520, 530,520, 580,520, 530,1620, 480,570, 580,470, 630,1520, 530,1620, 530,1620, 530,1620, 530,1620, 580,5170, 4430,4370, 530,1620, 530,520, 580,1570, 530,1620, 530,520, 580,520, 530,1620, 530,520, 580,520, 530,1620, 530,520, 580,520, 530,1620, 530,1620, 580,470, 580,1620, 480,1670, 480,520, 580,520, 530,1620, 580,1570, 580,1570, 530,1620, 580,1570, 580,470, 580,1570, 580,1570, 580,520, 580,470, 580,520, 530,520, 580,520, 530,520, 580,1570, 580,1570, 580,470, 580,520, 580,470, 580,520, 580,470, 580,1570, 580,520, 530,520, 580,1570, 580,1570, 530,1620, 530,1620, 530,1620, 530};  
// //22
// //{4330,4470, 480,1670, 480,570, 530,1670, 480,1670, 480,570, 480,570, 530,1670, 480,570, 480,570, 530,1670, 480,520, 530,570, 530,1620, 480,1670, 530,520, 530,1670, 480,1670, 480,570, 480,570, 530,1670, 480,1670, 480,1620, 530,1670, 480,1620, 530,570, 480,1670, 480,1670, 530,520, 530,570, 480,570, 530,570, 480,570, 530,520, 530,1670, 480,1620, 530,1620, 530,570, 480,570, 530,570, 480,570, 530,1670, 480,570, 480,570, 480,620, 480,1670, 480,1670, 480,1670, 480,1670, 480,5220, 4380,4420, 480,1670, 480,570, 580,1570, 530,1620, 530,570, 530,520, 530,1620, 530,570, 530,520, 530,1620, 530,570, 530,520, 530,1620, 530,1620, 530,520, 580,1570, 530,1620, 530,570, 530,520, 530,1620, 530,1620, 530,1620, 530,1620, 530,1620, 530,570, 480,1670, 480,1620, 530,570, 480,570, 530,570, 480,570, 530,570, 480,570, 530,1620, 530,1620, 530,1620, 530,570, 480,570, 530,570, 480,570, 530,1620, 530,570, 480,570, 480,570, 530,1620, 530,1670, 480,1670, 480,1670, 480}; 
// //23
// //{4380,4420, 530,1620, 530,520, 530,1670, 480,1670, 480,570, 530,520, 530,1670, 480,570, 530,520, 530,1670, 480,570, 530,520, 530,1670, 480,1620, 530,520, 580,1620, 480,1670, 480,570, 530,520, 530,1670, 480,1670, 480,1670, 480,1670, 480,1670, 480,570, 530,1620, 530,1620, 530,520, 530,570, 530,520, 530,570, 530,520, 530,520, 580,1620, 480,570, 530,1620, 530,520, 530,570, 530,520, 530,570, 530,1620, 530,520, 530,1670, 480,570, 530,1620, 530,1620, 530,1620, 530,1620, 530,5170, 4380,4420, 480,1670, 480,570, 530,1670, 480,1670, 480,570, 530,520, 530,1670, 480,570, 530,520, 530,1620, 530,520, 580,520, 530,1620, 530,1620, 480,570, 530,1670, 480,1670, 480,570, 480,570, 530,1670, 480,1670, 480,1670, 430,1670, 480,1670, 480,620, 480,1620, 530,1620, 530,570, 530,520, 580,520, 530,520, 580,520, 530,520, 580,1570, 530,570, 530,1620, 530,520, 530,570, 530,520, 530,570, 530,1620, 530,520, 530,1620, 530,520, 580,1570, 580,1570, 530,1620, 530,1620, 530};
// //24
// //{4330,4420, 530,1670, 480,570, 480,1670, 480,1670, 480,570, 530,520, 530,1670, 480,570, 480,570, 530,1620, 480,620, 480,570, 480,1720, 430,1670, 480,620, 480,1670, 480,1670, 480,570, 480,620, 480,1670, 480,1670, 480,1670, 480,1670, 480,1670, 480,570, 480,1670, 480,1670, 480,570, 530,570, 480,570, 480,620, 480,570, 480,1670, 480,1670, 480,620, 480,570, 480,620, 480,570, 480,620, 480,570, 480,620, 480,570, 480,1670, 480,1670, 480,1670, 480,1670, 480,1670, 480,1670, 480,5270, 4330,4420, 480,1670, 480,570, 530,1620, 530,1620, 530,570, 530,520, 530,1620, 530,570, 530,520, 580,1570, 530,570, 530,520, 580,1570, 530,1620, 530,570, 580,1570, 530,1620, 530,520, 530,520, 580,1620, 530,1620, 530,1620, 530,1570, 580,1570, 580,520, 580,1570, 580,1570, 580,470, 580,520, 580,470, 580,520, 530,520, 580,1570, 580,1570, 580,470, 580,520, 580,470, 580,520, 580,470, 580,520, 580,470, 580,520, 580,1570, 530,1620, 530,1620, 530,1620, 530,1620, 530,1570, 580};
// //25
// // {4330,4420, 530,1670, 480,570, 480,1670, 480,1670, 480,570, 530,520, 530,1670, 480,570, 480,570, 530,1620, 480,620, 480,570, 480,1720, 430,1670, 480,620, 480,1670, 480,1670, 480,570, 480,620, 480,1670, 480,1670, 480,1670, 480,1670, 480,1670, 480,570, 480,1670, 480,1670, 480,570, 530,570, 480,570, 480,620, 480,570, 480,1670, 480,1670, 480,620, 480,570, 480,620, 480,570, 480,620, 480,570, 480,620, 480,570, 480,1670, 480,1670, 480,1670, 480,1670, 480,1670, 480,1670, 480,5270, 4330,4420, 480,1670, 480,570, 530,1620, 530,1620, 530,570, 530,520, 530,1620, 530,570, 530,520, 580,1570, 530,570, 530,520, 580,1570, 530,1620, 530,570, 580,1570, 530,1620, 530,520, 530,520, 580,1620, 530,1620, 530,1620, 530,1570, 580,1570, 580,520, 580,1570, 580,1570, 580,470, 580,520, 580,470, 580,520, 530,520, 580,1570, 580,1570, 580,470, 580,520, 580,470, 580,520, 580,470, 580,520, 580,470, 580,520, 580,1570, 530,1620, 530,1620, 530,1620, 530,1620, 530,1570, 580};
// //26
// //{4430,4370, 530,1620, 480,570, 530,1670, 480,1670, 480,570, 480,570, 530,1670, 480,570, 480,570, 530,1670, 430,620, 480,570, 480,1720, 480,1620, 480,620, 480,1670, 480,1670, 480,570, 480,620, 480,1670, 480,1670, 480,1620, 530,1620, 530,1620, 530,570, 480,1670, 480,1670, 480,570, 480,620, 480,570, 480,620, 480,570, 480,1670, 480,1670, 480,620, 480,1670, 480,570, 530,570, 480,570, 530,570, 480,570, 530,570, 530,1620, 480,570, 530,1620, 530,1620, 530,1620, 530,1620, 530,5220, 4380,4370, 580,1620, 530,520, 530,1620, 530,1570, 580,520, 580,470, 580,1570, 580,520, 580,470, 580,1570, 580,520, 580,470, 580,1570, 580,1570, 580,520, 580,1570, 580,1570, 530,520, 580,520, 530,1570, 580,1570, 580,1570, 580,1570, 580,1570, 580,520, 530,1620, 530,1620, 530,520, 530,570, 530,520, 530,570, 530,520, 530,1620, 530,1620, 530,570, 530,1570, 530,570, 530,520, 530,570, 480,570, 530,570, 480,570, 530,1620, 530,570, 480,1670, 480,1670, 480,1670, 480,1670, 480};  
// //27
// // {4330,4420, 530,1670, 480,570, 530,1620, 480,1670, 530,520, 530,520, 580,1620, 530,520, 530,520, 580,1620, 480,570, 530,520, 530,1670, 480,1670, 480,570, 530,1620, 530,1620, 480,570, 530,570, 530,1620, 530,1620, 530,1620, 530,1620, 530,1620, 530,520, 530,1670, 480,1670, 480,570, 530,520, 530,520, 530,570, 530,520, 530,1670, 530,520, 530,520, 580,1620, 480,570, 530,520, 530,570, 530,520, 530,570, 480,1670, 480,1670, 480,570, 530,1670, 480,1670, 480,1670, 480,1670, 480,5220, 4380,4370, 530,1620, 530,570, 530,1620, 480,1670, 480,570, 530,570, 480,1670, 480,570, 530,570, 480,1670, 480,570, 530,520, 530,1670, 480,1620, 530,570, 480,1670, 480,1670, 480,570, 480,620, 480,1670, 480,1670, 480,1670, 480,1670, 480,1670, 480,570, 530,1620, 480,1670, 480,570, 530,570, 530,520, 580,520, 530,520, 580,1570, 580,520, 530,520, 580,1570, 530,570, 530,520, 530,570, 530,520, 530,570, 530,1620, 530,1620, 530,520, 530,1620, 530,1620, 530,1620, 530,1620, 530};  
// //28
// //{4380,4420, 530,1620, 530,520, 530,1670, 480,1670, 480,570, 530,520, 530,1670, 480,570, 530,520, 530,1620, 530,520, 580,520, 530,1620, 530,1620, 530,520, 530,1670, 480,1670, 480,570, 530,520, 530,1670, 480,1670, 480,1670, 480,1670, 480,1670, 480,570, 530,1620, 530,1620, 530,520, 530,570, 530,520, 530,570, 530,520, 530,1620, 530,520, 580,520, 530,520, 580,520, 530,520, 580,520, 530,520, 530,570, 530,1620, 530,1620, 530,1620, 530,1620, 530,1620, 530,1620, 530,1620, 530,5170, 4380,4420, 530,1620, 530,520, 530,1670, 480,1670, 480,570, 530,520, 530,1670, 480,570, 530,520, 530,1670, 480,570, 530,520, 530,1670, 480,1670, 480,570, 530,1620, 530,1620, 480,570, 530,520, 530,1670, 480,1670, 480,1670, 480,1670, 480,1670, 480,570, 480,1670, 480,1670, 480,570, 530,570, 480,570, 530,570, 480,570, 530,1620, 530,520, 530,570, 530,520, 530,570, 530,520, 530,570, 480,570, 530,570, 480,1670, 480,1670, 480,1670, 480,1670, 480,1670, 480,1670, 480,1670, 480};  
// //29
// //{4380,4370, 530,1670, 480,570, 530,1620, 530,1620, 530,520, 530,570, 530,1620, 530,520, 530,570, 530,1620, 530,520, 530,570, 530,1620, 530,1620, 530,520, 530,1670, 480,1620, 530,520, 580,520, 530,1620, 530,1620, 530,1620, 530,1620, 530,1620, 530,520, 530,1670, 480,1670, 480,570, 530,520, 530,570, 530,520, 530,570, 530,1620, 480,570, 530,1670, 480,520, 580,520, 530,520, 580,520, 530,520, 530,570, 530,1620, 480,570, 530,1670, 480,1670, 480,1670, 480,1670, 480,1670, 480,5220, 4330,4420, 480,1670, 480,620, 480,1670, 480,1670, 480,570, 530,570, 480,1670, 480,570, 530,570, 530,1620, 480,570, 530,570, 530,1620, 530,1620, 480,570, 530,1620, 530,1620, 530,520, 580,520, 480,1670, 530,1620, 480,1670, 480,1670, 480,1670, 480,570, 530,1620, 530,1620, 530,570, 480,570, 530,520, 530,570, 480,570, 530,1620, 530,570, 480,1670, 480,570, 530,570, 480,570, 530,570, 480,570, 530,570, 480,1670, 480,570, 530,1620, 530,1620, 480,1670, 480,1670, 480,1670, 480};  
// //30
// // {4330,4420, 480,1670, 480,620, 480,1670, 480,1670, 480,570, 480,570, 530,1620, 530,570, 480,570, 530,1620, 480,620, 480,570, 480,1670, 480,1670, 480,620, 480,1670, 480,1670, 480,570, 480,620, 480,1670, 480,1670, 480,1670, 480,1670, 480,1670, 480,570, 480,1670, 480,1670, 480,570, 530,570, 480,570, 530,570, 480,570, 530,1620, 480,620, 480,1670, 480,1670, 480,570, 480,620, 480,570, 480,620, 480,570, 480,1670, 480,620, 480,570, 480,1670, 480,1670, 480,1670, 480,1670, 480,5270, 4330,4420, 480,1670, 480,620, 480,1670, 480,1670, 480,570, 480,620, 480,1620, 530,570, 480,570, 530,1620, 480,620, 530,520, 530,1620, 480,1720, 430,620, 530,1620, 480,1670, 480,570, 580,520, 530,1620, 530,1620, 530,1620, 530,1620, 530,1570, 580,520, 530,1620, 530,1620, 530,520, 580,520, 580,470, 580,520, 580,470, 580,1570, 580,520, 530,1620, 530,1620, 530,520, 580,520, 530,520, 530,520, 580,520, 530,1620, 530,520, 580,520, 530,1620, 530,1620, 530,1620, 530,1620, 530};  



void Timer_ISR()
{
    if (TIMER_GetInterruptFlags(TIMER_INSTANCE) & TIMER_Match0InterruptFlag)
    {
        update = 1;
        TIMER_ClearInterruptFlags(TIMER_INSTANCE, TIMER_Match0InterruptFlag);
    }
}

void pwm_config(void)
{
    // unsigned int dutyCycle = PWM_INIT_DUTY_CYCLE_PERCENT;

    printf("TIMER Example Start\r\n");

    // PWM out pin config
    pad_config_t config;

    PAD_GetDefaultConfig(&config);
    config.mux = PWM_OUT_ALT_SEL;
    PAD_SetPinConfig(PWM_OUT_PIN, &config);

    // Config PWM clock, source from 26MHz and divide by 1
    CLOCK_SetClockSrc(PWM_CLOCK_ID, PWM_CLOCK_SOURCE);
    CLOCK_SetClockDiv(PWM_CLOCK_ID, 1);

    TIMER_DriverInit();

    timer_pwm_config_t pwmConfig;
    pwmConfig.pwmFreq_HZ = 38000;
    pwmConfig.srcClock_HZ = GPR_GetClockFreq(PWM_CLOCK_ID);  // 26MHz
    pwmConfig.dutyCyclePercent = PWM_INIT_DUTY_CYCLE_PERCENT;

    TIMER_SetupPwm(PWM_INSTANCE, &pwmConfig);

}

void start_pwm(uint16_t time)
{
   TIMER_Start(PWM_INSTANCE);
    //HT_GPIO_WritePin(LED_GPIO_PIN, LED_INSTANCE, LED_ON);   
    if(time > 0) custom_delay_usec(time);
  
}

void stop_pwm(uint16_t time)
{
    TIMER_Stop(PWM_INSTANCE);
     //HT_GPIO_WritePin(LED_GPIO_PIN, LED_INSTANCE, LED_OFF);   
    if(time > 0) custom_delay_usec(time);

}

// void vPwm(void)
// {
//     for (uint16_t i = 0; i < SIGNAL_LEN; i++)
//     {
//         if ( i & 1 )
//             stop_pwm(rawUs[i]);
            
//         else
//             start_pwm(rawUs[i]);
//     }
//     stop_pwm(0);
//     while(1);

// }

// void HT_pwm(void)
// {
//   BSP_CommonInit();
//   pwm_config();
//   vPwmTask();
//     while(1);
// }